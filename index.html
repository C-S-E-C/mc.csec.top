<!DOCTYPE html>
<html>
<head>
    <title>CSECMC服务器</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        .container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
        #gallery {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        #gallery2 {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            z-index: -1;
            transition: opacity 0.8s ease-in-out;
        }
        .controls {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            display: flex;
            gap: 15px;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 15px 25px;
            border-radius: 50px;
            backdrop-filter: blur(10px);
        }
        button {
            padding: 10px 20px;
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            min-width: 100px;
        }
        button:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        .info {
            position: absolute;
            top: 30px;
            left: 30px;
            color: white;
            font-size: 16px;
            z-index: 100;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 10px 20px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
        }
        .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            z-index: 1000;
        }
        @keyframes spin {
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }
        #title {
            position: absolute;
            top: 45%;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 60px;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="title">欢迎来到CSECMC服务器</h1>
        <h1 style="color:white;left:50%;bottom:5%;position: absolute;">↓</h1>
        <canvas id="gallery"></canvas>
        <canvas id="gallery2"></canvas>
        <div id="loader" class="loader" style="display: none;"></div>
    </div>

    <script>
        // 全局变量
        let canvas1, canvas2, ctx1, ctx2;
        let images = [];
        let currentImageIndex = 0;
        let nextImageIndex = 0;
        let slideshowInterval = null;
        let slideshowSpeed = 3000;
        let isTransitioning = false;
        
        // 预加载图片
        function preloadImages() {
            showLoader();
            const imagePromises = [];
            
            for (let i = 0; i <= 2; i++) {
                const promise = new Promise((resolve, reject) => {
                    const img = new Image();
                    img.src = `images/background.${i}.webp`;
                    img.onload = () => {
                        console.log(`图片 ${i} 预加载成功`);
                        resolve(img);
                    };
                    img.onerror = () => {
                        console.warn(`图片 ${i} 加载失败，使用备用图片`);
                        resolve(createFallbackImage(i));
                    };
                });
                imagePromises.push(promise);
            }
            
            Promise.all(imagePromises).then(loadedImages => {
                images = loadedImages;
                hideLoader();
                init();
            }).catch(error => {
                console.error('图片加载失败:', error);
                hideLoader();
            });
        }
        
        // 创建备用图片
        function createFallbackImage(index) {
            const canvas = document.createElement('canvas');
            canvas.width = 1920;
            canvas.height = 1080;
            const ctx = canvas.getContext('2d');
            
            // 创建纯色背景
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 添加文字
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.font = 'bold 60px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(`图片 ${index}`, canvas.width / 2, canvas.height / 2 - 50);
            
            const img = new Image();
            img.src = canvas.toDataURL();
            return img;
        }
        
        // 显示加载器
        function showLoader() {
            document.getElementById('loader').style.display = 'block';
        }
        
        // 隐藏加载器
        function hideLoader() {
            document.getElementById('loader').style.display = 'none';
        }
        
        // 初始化函数
        function init() {
            if (images.length === 0) return;
            
            // 获取canvas元素
            canvas1 = document.getElementById("gallery");
            canvas2 = document.getElementById("gallery2");
            
            // 设置canvas尺寸
            canvas1.width = window.innerWidth;
            canvas1.height = window.innerHeight;
            canvas2.width = window.innerWidth;
            canvas2.height = window.innerHeight;
            
            // 获取2D上下文
            ctx1 = canvas1.getContext("2d");
            ctx2 = canvas2.getContext("2d");
            
            // 启用高质量图像平滑
            enableHighQualityRendering(ctx1);
            enableHighQualityRendering(ctx2);
            
            // 绘制第一张图片（完全填充）
            drawImageToCanvas(ctx1, images[0], true);
            
            // 启动自动播放
            startSlideshow();
            
            // 添加窗口大小调整监听
            window.addEventListener('resize', handleResize);
        }
        
        // 启用高质量渲染
        function enableHighQualityRendering(context) {
            context.imageSmoothingEnabled = true;
            context.imageSmoothingQuality = 'high';
            context.webkitImageSmoothingEnabled = true;
            context.mozImageSmoothingEnabled = true;
            context.msImageSmoothingEnabled = true;
            context.oImageSmoothingEnabled = true;
        }
        
        // 绘制图片到指定canvas - 修复黑边问题
        function drawImageToCanvas(context, img, fillMode = true) {
            const canvas = context.canvas;
            const imgRatio = img.width / img.height;
            const canvasRatio = canvas.width / canvas.height;
            
            let drawWidth, drawHeight, offsetX, offsetY;
            
            if (fillMode) {
                // 填充模式：完全填充画布，可能会裁剪部分图片
                if (imgRatio > canvasRatio) {
                    // 图片更宽，按高度填充
                    drawHeight = canvas.height;
                    drawWidth = canvas.height * imgRatio;
                    offsetX = (canvas.width - drawWidth) / 2;
                    offsetY = 0;
                } else {
                    // 图片更高，按宽度填充
                    drawWidth = canvas.width;
                    drawHeight = canvas.width / imgRatio;
                    offsetX = 0;
                    offsetY = (canvas.height - drawHeight) / 2;
                }
            } else {
                // 适应模式：完整显示图片，可能会有黑边
                if (imgRatio > canvasRatio) {
                    // 图片更宽，按宽度适应
                    drawWidth = canvas.width;
                    drawHeight = canvas.width / imgRatio;
                    offsetX = 0;
                    offsetY = (canvas.height - drawHeight) / 2;
                } else {
                    // 图片更高，按高度适应
                    drawHeight = canvas.height;
                    drawWidth = canvas.height * imgRatio;
                    offsetX = (canvas.width - drawWidth) / 2;
                    offsetY = 0;
                }
            }
            
            // 清除并绘制
            context.clearRect(0, 0, canvas.width, canvas.height);
            
            // 如果需要，可以先填充黑色背景
            context.fillStyle = '#000';
            context.fillRect(0, 0, canvas.width, canvas.height);
            
            context.drawImage(img, offsetX, offsetY, drawWidth, drawHeight);
        }
        
        // 平滑切换图片
        function transitionToNextImage() {
            if (isTransitioning || images.length === 0) return;
            
            isTransitioning = true;
            nextImageIndex = (currentImageIndex + 1) % images.length;
            
            // 在第二个canvas上绘制下一张图片
            drawImageToCanvas(ctx2, images[nextImageIndex], true);
            
            // 淡入淡出动画
            let opacity = 0;
            canvas2.style.opacity = opacity;
            
            const fadeIn = () => {
                opacity += 0.02;
                canvas2.style.opacity = opacity;
                
                if (opacity < 1) {
                    requestAnimationFrame(fadeIn);
                } else {
                    // 动画完成
                    [canvas1, canvas2] = [canvas2, canvas1];
                    [ctx1, ctx2] = [ctx2, ctx1];
                    
                    canvas2.style.opacity = 0;
                    currentImageIndex = nextImageIndex;
                    isTransitioning = false;
                }
            };
            
            requestAnimationFrame(fadeIn);
        }
        
        // 下一张图片
        function nextImage() {
            if (isTransitioning) return;
            transitionToNextImage();
        }
        
        // 上一张图片
        function prevImage() {
            if (isTransitioning || images.length === 0) return;
            
            isTransitioning = true;
            nextImageIndex = (currentImageIndex - 1 + images.length) % images.length;
            
            // 在第二个canvas上绘制上一张图片
            drawImageToCanvas(ctx2, images[nextImageIndex], true);
            
            // 淡入淡出动画
            let opacity = 0;
            canvas2.style.opacity = opacity;
            
            const fadeIn = () => {
                opacity += 0.02;
                canvas2.style.opacity = opacity;
                
                if (opacity < 1) {
                    requestAnimationFrame(fadeIn);
                } else {
                    // 动画完成
                    [canvas1, canvas2] = [canvas2, canvas1];
                    [ctx1, ctx2] = [ctx2, ctx1];
                    
                    canvas2.style.opacity = 0;
                    currentImageIndex = nextImageIndex;
                    isTransitioning = false;
                }
            };
            
            requestAnimationFrame(fadeIn);
        }
        
        // 开始自动播放
        function startSlideshow() {
            if (slideshowInterval) {
                clearInterval(slideshowInterval);
            }
            slideshowInterval = setInterval(() => {
                if (!isTransitioning) {
                    transitionToNextImage();
                }
            }, slideshowSpeed);
        }
        
        // 暂停/继续自动播放
        function toggleSlideshow() {
            if (slideshowInterval) {
                clearInterval(slideshowInterval);
                slideshowInterval = null;
            } else {
                startSlideshow();
            }
        }
        
        // 处理窗口大小调整
        function handleResize() {
            if (!canvas1 || !images.length) return;
            
            canvas1.width = window.innerWidth;
            canvas1.height = window.innerHeight;
            canvas2.width = window.innerWidth;
            canvas2.height = window.innerHeight;
            
            // 重新绘制当前图片
            drawImageToCanvas(ctx1, images[currentImageIndex], true);
            
            // 如果正在过渡，也重新绘制下一张图片
            if (isTransitioning) {
                drawImageToCanvas(ctx2, images[nextImageIndex], true);
            }
            
            // 重置图像平滑
            enableHighQualityRendering(ctx1);
            enableHighQualityRendering(ctx2);
        }
        
        // 页面加载完成后初始化
        window.addEventListener('DOMContentLoaded', () => {
            console.log("DOM已加载，预加载图片...");
            preloadImages();
        });
        
        // 键盘控制
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'ArrowLeft':
                    prevImage();
                    break;
                case 'ArrowRight':
                    nextImage();
                    break;
                case ' ':
                    e.preventDefault();
                    toggleSlideshow();
                    break;
                case 'f':
                case 'F':
                    if (document.fullscreenElement) {
                        document.exitFullscreen();
                    } else {
                        document.documentElement.requestFullscreen();
                    }
                    break;
            }
        });
        
        // 添加触摸滑动支持
        let touchStartX = 0;
        
        document.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
        });
        
        document.addEventListener('touchend', (e) => {
            if (isTransitioning) return;
            
            const touchEndX = e.changedTouches[0].clientX;
            const diffX = touchEndX - touchStartX;
            
            // 滑动距离超过50px触发切换
            if (Math.abs(diffX) > 50) {
                if (diffX > 0) {
                    prevImage();
                } else {
                    nextImage();
                }
            }
        });
        
        // 添加鼠标滚轮支持
        document.addEventListener('wheel', (e) => {
            if (isTransitioning) return;
            
            if (e.deltaY > 0) {
                nextImage();
            } else if (e.deltaY < 0) {
                prevImage();
            }
        }, { passive: true });
        
        // 添加点击切换功能
        document.addEventListener('click', (e) => {
            if (isTransitioning) return;
            
            const clickX = e.clientX;
            const windowWidth = window.innerWidth;
            
            // 点击左侧1/3区域：上一张
            if (clickX < windowWidth / 3) {
                prevImage();
            }
            // 点击右侧1/3区域：下一张
            else if (clickX > windowWidth * 2 / 3) {
                nextImage();
            }
            // 点击中间区域：切换播放状态
            else {
                toggleSlideshow();
            }
        });
    </script>
</body>

</html>

