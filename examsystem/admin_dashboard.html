<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Exam Site</title>
    <link rel="stylesheet" href="static/css/style.css">
</head>
<body>
    <div class="admin-layout">
        <div class="admin-sidebar">
            <div class="admin-header">
                <h2>Admin Panel</h2>
                <p id="admin-name"></p>
            </div>
            <nav class="admin-nav">
                <a href="#" class="nav-item active" data-view="submissions" onclick="switchView('submissions')">All Submissions</a>
                <a href="#" class="nav-item" data-view="questions" onclick="switchView('questions')">Manage Questions</a>
                <a href="#" class="nav-item" data-view="recordings" onclick="switchView('recordings')">Manage Recordings</a>
                <a href="#" class="nav-item" data-view="admins" onclick="switchView('admins')">Manage Admins</a>
                <a href="admin_login.html" class="nav-item" onclick="logout()">Logout</a>
            </nav>
        </div>
        
        <div class="admin-content">
            <!-- Submissions View -->
            <div id="submissions-view">
                <h1>Exam Submissions</h1>
                <div class="filter-section">
                    <input type="text" id="search" placeholder="Search by name or student ID..." class="search-input">
                    <select id="subjectFilter" class="filter-select">
                        <option value="">All Subjects</option>
                    </select>
                    <select id="statusFilter" class="filter-select">
                        <option value="">All Status</option>
                        <option value="pending">Pending Review</option>
                        <option value="passed">Passed</option>
                        <option value="failed">Failed</option>
                        <option value="cheated">Cheated</option>
                    </select>
                </div>
                
                <div id="submissions-list" class="submissions-list">
                    <p class="loading">Loading submissions...</p>
                </div>
            </div>
            
            <!-- Exam Detail View -->
            <div id="exam-detail-view" style="display: none;">
                <button onclick="showSubmissions()" class="btn-back">Back to Submissions</button>
                <div id="exam-detail-content"></div>
            </div>
            
            <!-- Questions Management View -->
            <div id="questions-view" style="display: none;">
                <h1>Manage Questions</h1>
                
                <div class="add-question-section">
                    <h2>Add New Question</h2>
                    <form id="add-question-form" class="question-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Subject</label>
                                <input type="text" id="q-subject" list="subject-list" placeholder="e.g., Mathematics" required>
                                <datalist id="subject-list"></datalist>
                            </div>
                            <div class="form-group">
                                <label>Question Type</label>
                                <select id="q-type" required onchange="toggleQuestionFields()">
                                    <option value="">Select Type</option>
                                    <option value="multiple_choice">Multiple Choice</option>
                                    <option value="fill_in_blank">Fill in the Blank</option>
                                    <option value="long_answer">Long Answer</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Question Text</label>
                            <textarea id="q-text" rows="3" required placeholder="Enter the question..."></textarea>
                        </div>
                        
                        <div id="mc-options" class="form-group" style="display: none;">
                            <label>Options (one per line)</label>
                            <textarea id="q-options" rows="4" placeholder="Option A&#10;Option B&#10;Option C&#10;Option D"></textarea>
                        </div>
                        
                        <div id="correct-answer-group" class="form-group" style="display: none;">
                            <label>Correct Answer</label>
                            <input type="text" id="q-correct" placeholder="Enter the correct answer">
                        </div>
                        
                        <div id="sample-answer-group" class="form-group" style="display: none;">
                            <label>Sample Answer (for grading reference)</label>
                            <textarea id="q-sample" rows="4" placeholder="Enter a sample answer for reference..."></textarea>
                        </div>
                        
                        <button type="submit" class="btn-primary">Add Question</button>
                    </form>
                </div>
                
                <div class="questions-list-section">
                    <h2>Existing Questions</h2>
                    <div class="filter-section">
                        <select id="filterSubject" class="filter-select" onchange="loadQuestions()">
                            <option value="">All Subjects</option>
                        </select>
                        <select id="filterType" class="filter-select" onchange="loadQuestions()">
                            <option value="">All Types</option>
                            <option value="multiple_choice">Multiple Choice</option>
                            <option value="fill_in_blank">Fill in the Blank</option>
                            <option value="long_answer">Long Answer</option>
                        </select>
                    </div>
                    <div id="questions-list" class="questions-list">
                        <p class="loading">Loading questions...</p>
                    </div>
                </div>
            </div>
            
            <!-- Recordings Management View -->
            <div id="recordings-view" style="display: none;">
                <h1>Manage Recordings</h1>
                <p class="view-description">View and manage all exam recordings. Deleting a recording will also update associated exams.</p>
                
                <div class="filter-section">
                    <input type="text" id="recording-search" placeholder="Search by name or student ID..." class="search-input">
                    <select id="recordingSubjectFilter" class="filter-select">
                        <option value="">All Subjects</option>
                    </select>
                </div>
                
                <div id="recordings-list" class="recordings-list">
                    <p class="loading">Loading recordings...</p>
                </div>
            </div>
            
            <!-- Admins Management View -->
            <div id="admins-view" style="display: none;">
                <h1>Manage Admins</h1>
                
                <div class="add-admin-section">
                    <h2>Add New Admin</h2>
                    <form id="add-admin-form" class="admin-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Name</label>
                                <input type="text" id="admin-name-input" required>
                            </div>
                            <div class="form-group">
                                <label>Username</label>
                                <input type="text" id="admin-username" required>
                            </div>
                            <div class="form-group">
                                <label>Password</label>
                                <input type="password" id="admin-password" required>
                            </div>
                            <button type="submit" class="btn-primary btn-add">Add Admin</button>
                        </div>
                    </form>
                </div>
                
                <div class="admins-list-section">
                    <h2>Existing Admins</h2>
                    <div id="admins-list" class="admins-list">
                        <p class="loading">Loading admins...</p>
                    </div>
                </div>
            </div>
            
            <!-- Recording View Modal -->
            <div id="recording-modal" class="modal" style="display: none;">
                <div class="modal-content recording-modal-content">
                    <div class="modal-header">
                        <h2>Exam Recording</h2>
                        <button onclick="closeRecordingModal()" class="btn-close">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="recording-player-container">
                            <div class="recording-player" style="width: 100%;">
                                <h3>Screen Recording</h3>
                                <video id="screen-video" controls style="width: 100%;"></video>
                                <p id="screen-status" class="recording-status-text">Loading...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="static/js/main.js"></script>
    <script>
    const API_BASE = 'https://1.s.csec.top:10097';
    
    let allSubmissions = [];
    let allRecordings = [];
    let currentExamId = null;

    function switchView(view) {
        document.getElementById('submissions-view').style.display = 'none';
        document.getElementById('exam-detail-view').style.display = 'none';
        document.getElementById('admins-view').style.display = 'none';
        document.getElementById('questions-view').style.display = 'none';
        document.getElementById('recordings-view').style.display = 'none';
        
        document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.remove('active');
            if (item.dataset.view === view) {
                item.classList.add('active');
            }
        });
        
        if (view === 'submissions') {
            document.getElementById('submissions-view').style.display = 'block';
            loadSubmissions();
            loadSubjectsFilter();
        } else if (view === 'admins') {
            document.getElementById('admins-view').style.display = 'block';
            loadAdmins();
        } else if (view === 'questions') {
            document.getElementById('questions-view').style.display = 'block';
            loadQuestions();
            loadSubjectsForQuestions();
        } else if (view === 'recordings') {
            document.getElementById('recordings-view').style.display = 'block';
            loadRecordings();
            loadRecordingSubjectsFilter();
        }
    }

    async function loadRecordings() {
        try {
            const response = await fetch(`${API_BASE}/api/admin/recordings`, {
                credentials: 'include'
            });
            const data = await response.json();
            allRecordings = data;
            renderRecordings(data);
        } catch (error) {
            document.getElementById('recordings-list').innerHTML = '<p class="error">Failed to load recordings</p>';
        }
    }

    async function loadRecordingSubjectsFilter() {
        try {
            const response = await fetch(`${API_BASE}/api/admin/questions/subjects`, {
                credentials: 'include'
            });
            const subjects = await response.json();
            
            const filterSelect = document.getElementById('recordingSubjectFilter');
            filterSelect.innerHTML = '<option value="">All Subjects</option>';
            subjects.forEach(subject => {
                filterSelect.innerHTML += `<option value="${subject}">${subject}</option>`;
            });
        } catch (error) {
            console.error('Failed to load subjects');
        }
    }

    function formatFileSize(bytes) {
        if (!bytes || bytes === 0) return '0 B';
        const k = 1024;
        const sizes = ['B', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    function renderRecordings(recordings) {
        const listDiv = document.getElementById('recordings-list');
        
        if (recordings.length === 0) {
            listDiv.innerHTML = '<p class="no-data">No recordings found</p>';
            return;
        }
        
        const html = recordings.map(rec => {
            const screenSize = formatFileSize(rec.screen_recording_size || 0);
            
            return `
                <div class="recording-card">
                    <div class="recording-header">
                        <div>
                            <h3>${rec.name || 'Unknown'}</h3>
                            <p class="student-id">ID: ${rec.student_id || 'N/A'}</p>
                        </div>
                        <span class="subject-badge">${rec.subject || 'Unknown'}</span>
                    </div>
                    <div class="recording-info">
                        <p><strong>Started:</strong> ${rec.started_at ? new Date(rec.started_at).toLocaleString() : 'N/A'}</p>
                        <p><strong>Status:</strong> ${rec.status || 'unknown'}</p>
                        <div class="recording-files">
                            <span class="${rec.has_screen ? 'file-available' : 'file-missing'}">
                                Screen: ${rec.has_screen ? screenSize : 'Not available'}
                            </span>
                        </div>
                    </div>
                    <div class="recording-actions">
                        <button onclick="viewRecording('${rec._id}')" class="btn-view" ${!rec.has_screen ? 'disabled' : ''}>View</button>
                        <button onclick="deleteRecording('${rec._id}')" class="btn-delete">Delete</button>
                    </div>
                </div>
            `;
        }).join('');
        
        listDiv.innerHTML = html;
    }

    async function deleteRecording(recordingId) {
        if (!confirm('Are you sure you want to delete this recording? This action cannot be undone.')) {
            return;
        }
        
        try {
            const response = await fetch(`${API_BASE}/api/admin/delete-recording/${recordingId}`, {
                method: 'DELETE',
                credentials: 'include'
            });
            const data = await response.json();
            
            if (data.success) {
                alert('Recording deleted successfully');
                loadRecordings();
            } else {
                alert('Error deleting recording: ' + data.message);
            }
        } catch (error) {
            alert('Error deleting recording');
        }
    }

    document.getElementById('recording-search')?.addEventListener('input', filterRecordings);
    document.getElementById('recordingSubjectFilter')?.addEventListener('change', filterRecordings);

    function filterRecordings() {
        const search = document.getElementById('recording-search').value.toLowerCase();
        const subject = document.getElementById('recordingSubjectFilter').value;
        
        const filtered = allRecordings.filter(rec => {
            const matchSearch = (rec.name || '').toLowerCase().includes(search) || 
                               (rec.student_id || '').toLowerCase().includes(search);
            const matchSubject = !subject || rec.subject === subject;
            return matchSearch && matchSubject;
        });
        
        renderRecordings(filtered);
    }

    async function loadSubjectsFilter() {
        try {
            const response = await fetch(`${API_BASE}/api/admin/questions/subjects`, {
                credentials: 'include'
            });
            const subjects = await response.json();
            
            const filterSelect = document.getElementById('subjectFilter');
            filterSelect.innerHTML = '<option value="">All Subjects</option>';
            subjects.forEach(subject => {
                filterSelect.innerHTML += `<option value="${subject}">${subject}</option>`;
            });
        } catch (error) {
            console.error('Failed to load subjects');
        }
    }

    function toggleQuestionFields() {
        const type = document.getElementById('q-type').value;
        
        document.getElementById('mc-options').style.display = type === 'multiple_choice' ? 'block' : 'none';
        document.getElementById('correct-answer-group').style.display = 
            (type === 'multiple_choice' || type === 'fill_in_blank') ? 'block' : 'none';
        document.getElementById('sample-answer-group').style.display = type === 'long_answer' ? 'block' : 'none';
    }

    async function loadSubjectsForQuestions() {
        try {
            const response = await fetch(`${API_BASE}/api/admin/questions/subjects`, {
                credentials: 'include'
            });
            const subjects = await response.json();
            
            const datalist = document.getElementById('subject-list');
            datalist.innerHTML = '';
            subjects.forEach(subject => {
                datalist.innerHTML += `<option value="${subject}">`;
            });
            
            const filterSelect = document.getElementById('filterSubject');
            filterSelect.innerHTML = '<option value="">All Subjects</option>';
            subjects.forEach(subject => {
                filterSelect.innerHTML += `<option value="${subject}">${subject}</option>`;
            });
        } catch (error) {
            console.error('Failed to load subjects');
        }
    }

    async function loadQuestions() {
        const subject = document.getElementById('filterSubject').value;
        const type = document.getElementById('filterType').value;
        
        let url = `${API_BASE}/api/admin/questions?`;
        if (subject) url += `subject=${encodeURIComponent(subject)}&`;
        if (type) url += `type=${encodeURIComponent(type)}`;
        
        try {
            const response = await fetch(url, {
                credentials: 'include'
            });
            const questions = await response.json();
            renderQuestions(questions);
        } catch (error) {
            document.getElementById('questions-list').innerHTML = '<p class="error">Failed to load questions</p>';
        }
    }

    function renderQuestions(questions) {
        const listDiv = document.getElementById('questions-list');
        
        if (questions.length === 0) {
            listDiv.innerHTML = '<p class="no-data">No questions found</p>';
            return;
        }
        
        const typeLabels = {
            'multiple_choice': 'Multiple Choice',
            'fill_in_blank': 'Fill in the Blank',
            'long_answer': 'Long Answer'
        };
        
        const html = questions.map(q => `
            <div class="question-card">
                <div class="question-card-header">
                    <span class="subject-badge">${q.subject}</span>
                    <span class="type-badge ${q.type}">${typeLabels[q.type] || q.type}</span>
                </div>
                <div class="question-card-body">
                    <p class="question-text">${q.question}</p>
                    ${q.type === 'multiple_choice' && q.options ? `
                        <div class="options-preview">
                            ${q.options.map(opt => `<span class="option-tag ${opt === q.correct_answer ? 'correct' : ''}">${opt}</span>`).join('')}
                        </div>
                    ` : ''}
                    ${q.type === 'fill_in_blank' ? `
                        <p class="correct-answer-preview"><strong>Answer:</strong> ${q.correct_answer}</p>
                    ` : ''}
                    ${q.type === 'long_answer' && q.sample_answer ? `
                        <p class="sample-preview"><strong>Sample:</strong> ${q.sample_answer.substring(0, 100)}${q.sample_answer.length > 100 ? '...' : ''}</p>
                    ` : ''}
                </div>
                <div class="question-card-actions">
                    <button onclick="deleteQuestion('${q._id}')" class="btn-delete">Delete</button>
                </div>
            </div>
        `).join('');
        
        listDiv.innerHTML = html;
    }

    document.getElementById('add-question-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const type = document.getElementById('q-type').value;
        const subject = document.getElementById('q-subject').value;
        const question = document.getElementById('q-text').value;
        const correctAnswer = document.getElementById('q-correct').value;
        const sampleAnswer = document.getElementById('q-sample').value;
        const optionsText = document.getElementById('q-options').value;
        
        const options = optionsText.split('\n').map(o => o.trim()).filter(o => o);
        
        try {
            const response = await fetch(`${API_BASE}/api/admin/add-question`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify({
                    type,
                    subject,
                    question,
                    correct_answer: correctAnswer,
                    sample_answer: sampleAnswer,
                    options
                })
            });
            
            const data = await response.json();
            
            if (data.success) {
                alert('Question added successfully');
                e.target.reset();
                loadQuestions();
                loadSubjectsForQuestions();
            } else {
                alert('Error adding question: ' + data.message);
            }
        } catch (error) {
            alert('Error adding question');
        }
    });

    async function deleteQuestion(questionId) {
        if (!confirm('Are you sure you want to delete this question?')) {
            return;
        }
        
        try {
            const response = await fetch(`${API_BASE}/api/admin/delete-question/${questionId}`, {
                method: 'DELETE',
                credentials: 'include'
            });
            const data = await response.json();
            
            if (data.success) {
                alert('Question deleted successfully');
                loadQuestions();
            } else {
                alert('Error deleting question: ' + data.message);
            }
        } catch (error) {
            alert('Error deleting question');
        }
    }

    async function loadSubmissions() {
        try {
            const response = await fetch(`${API_BASE}/api/admin/submissions`, {
                credentials: 'include'
            });
            const data = await response.json();
            allSubmissions = data;
            renderSubmissions(data);
        } catch (error) {
            document.getElementById('submissions-list').innerHTML = '<p class="error">Failed to load submissions</p>';
        }
    }

    function renderSubmissions(submissions) {
        const listDiv = document.getElementById('submissions-list');
        
        if (submissions.length === 0) {
            listDiv.innerHTML = '<p class="no-data">No submissions found</p>';
            return;
        }
        
        const statusLabels = {
            'pending': 'Pending Review',
            'passed': 'Passed',
            'cheated': 'Flagged',
            'failed': 'Failed'
        };
        
        const html = submissions.map(sub => `
            <div class="submission-card" onclick="viewExamDetail('${sub._id}')">
                <div class="submission-header">
                    <div>
                        <h3>${sub.name}</h3>
                        <p class="student-id">ID: ${sub.student_id}</p>
                    </div>
                    <span class="status-badge status-${sub.status}">${statusLabels[sub.status] || sub.status}</span>
                </div>
                <div class="submission-info">
                    <p><strong>Subject:</strong> ${sub.subject}</p>
                    <p><strong>Submitted:</strong> ${new Date(sub.submitted_at).toLocaleString()}</p>
                    <p><strong>Score:</strong> ${sub.score}/${sub.max_score}</p>
                </div>
            </div>
        `).join('');
        
        listDiv.innerHTML = html;
    }

    async function viewExamDetail(examId) {
        try {
            const response = await fetch(`${API_BASE}/api/admin/exam/${examId}`, {
                credentials: 'include'
            });
            const exam = await response.json();
            
            document.getElementById('submissions-view').style.display = 'none';
            document.getElementById('exam-detail-view').style.display = 'block';
            
            currentExamId = examId;
            renderExamDetail(exam);
        } catch (error) {
            alert('Error loading exam details');
        }
    }

    function renderExamDetail(exam) {
        const content = document.getElementById('exam-detail-content');
        
        const statusLabels = {
            'pending': 'Pending Review',
            'passed': 'Passed',
            'cheated': 'Flagged for Cheating',
            'failed': 'Failed'
        };
        
        content.innerHTML = `
            <div class="exam-detail">
                <div class="exam-detail-header">
                    <div>
                        <h2>${exam.name} - ${exam.subject}</h2>
                        <p>Student ID: ${exam.student_id}</p>
                        <p>Submitted: ${new Date(exam.submitted_at).toLocaleString()}</p>
                    </div>
                    <span class="status-badge status-${exam.status}">${statusLabels[exam.status]}</span>
                </div>
                
                <div class="score-summary">
                    <h3>Score Summary</h3>
                    <p><strong>Auto Score:</strong> ${exam.score}/${exam.max_score}</p>
                    <p><strong>Final Score:</strong> <input type="number" id="final-score" value="${exam.final_score !== undefined ? exam.final_score : exam.score}" min="0" max="${exam.max_score}"></p>
                    <div class="status-actions">
                        <button onclick="updateExamStatus('passed')" class="btn-success">Mark as Passed</button>
                        <button onclick="updateExamStatus('failed')" class="btn-danger">Mark as Failed</button>
                        <button onclick="updateExamStatus('cheated')" class="btn-warning">Flag for Cheating</button>
                        <button onclick="viewRecording('${exam.recording_id}')" class="btn-view" ${!exam.recording_id ? 'disabled' : ''}>View Recording</button>
                    </div>
                </div>
                
                <div class="answers-section">
                    <h3>Student Answers</h3>
                    ${exam.answers.map((ans, idx) => `
                        <div class="answer-card">
                            <p class="question-text"><strong>Q${idx + 1}:</strong> ${ans.question}</p>
                            <p><strong>Student Answer:</strong> ${ans.answer || '(No answer provided)'}</p>
                            ${ans.correct_answer ? `<p><strong>Correct Answer:</strong> ${ans.correct_answer}</p>` : ''}
                            ${ans.is_correct !== undefined ? `<p class="result ${ans.is_correct ? 'correct' : 'incorrect'}">${ans.is_correct ? '✓ Correct' : '✗ Incorrect'}</p>` : ''}
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }

    async function updateExamStatus(status) {
        const finalScore = document.getElementById('final-score').value;
        
        try {
            const response = await fetch(`${API_BASE}/api/admin/update-exam/${currentExamId}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify({
                    status,
                    final_score: parseInt(finalScore)
                })
            });
            
            const data = await response.json();
            
            if (data.success) {
                alert('Exam updated successfully');
                showSubmissions();
                loadSubmissions();
            } else {
                alert('Error updating exam: ' + data.message);
            }
        } catch (error) {
            alert('Error updating exam');
        }
    }

    function showSubmissions() {
        document.getElementById('exam-detail-view').style.display = 'none';
        document.getElementById('submissions-view').style.display = 'block';
        currentExamId = null;
    }

    async function viewRecording(recordingId) {
        if (!recordingId) {
            alert('No recording available');
            return;
        }
        
        try {
            const response = await fetch(`${API_BASE}/api/admin/recording/${recordingId}`, {
                credentials: 'include'
            });
            const data = await response.json();
            
            document.getElementById('recording-modal').style.display = 'flex';
            
            const screenVideo = document.getElementById('screen-video');
            const screenStatus = document.getElementById('screen-status');
            
            if (data.screen_recording) {
                screenVideo.src = data.screen_recording;
                screenVideo.style.display = 'block';
                screenStatus.style.display = 'none';
            } else {
                screenVideo.style.display = 'none';
                screenStatus.textContent = 'Screen recording not available';
                screenStatus.style.display = 'block';
            }
        } catch (error) {
            alert('Error loading recording');
        }
    }

    function closeRecordingModal() {
        document.getElementById('recording-modal').style.display = 'none';
        const screenVideo = document.getElementById('screen-video');
        screenVideo.pause();
        screenVideo.src = '';
    }

    async function loadAdmins() {
        try {
            const response = await fetch(`${API_BASE}/api/admin/admins`, {
                credentials: 'include'
            });
            const admins = await response.json();
            renderAdmins(admins);
        } catch (error) {
            document.getElementById('admins-list').innerHTML = '<p class="error">Failed to load admins</p>';
        }
    }

    function renderAdmins(admins) {
        const listDiv = document.getElementById('admins-list');
        
        if (admins.length === 0) {
            listDiv.innerHTML = '<p class="no-data">No admins found</p>';
            return;
        }
        
        const html = admins.map(admin => `
            <div class="admin-card">
                <div>
                    <h3>${admin.name}</h3>
                    <p>Username: ${admin.username}</p>
                </div>
                <button onclick="deleteAdmin('${admin._id}')" class="btn-delete">Delete</button>
            </div>
        `).join('');
        
        listDiv.innerHTML = html;
    }

    document.getElementById('add-admin-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const name = document.getElementById('admin-name-input').value;
        const username = document.getElementById('admin-username').value;
        const password = document.getElementById('admin-password').value;
        
        try {
            const response = await fetch(`${API_BASE}/api/admin/add-admin`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify({ name, username, password })
            });
            
            const data = await response.json();
            
            if (data.success) {
                alert('Admin added successfully');
                e.target.reset();
                loadAdmins();
            } else {
                alert('Error adding admin: ' + data.message);
            }
        } catch (error) {
            alert('Error adding admin');
        }
    });

    async function deleteAdmin(adminId) {
        if (!confirm('Are you sure you want to delete this admin?')) {
            return;
        }
        
        try {
            const response = await fetch(`${API_BASE}/api/admin/delete-admin/${adminId}`, {
                method: 'DELETE',
                credentials: 'include'
            });
            const data = await response.json();
            
            if (data.success) {
                alert('Admin deleted successfully');
                loadAdmins();
            } else {
                alert('Error deleting admin: ' + data.message);
            }
        } catch (error) {
            alert('Error deleting admin');
        }
    }

    document.getElementById('search')?.addEventListener('input', filterSubmissions);
    document.getElementById('subjectFilter')?.addEventListener('change', filterSubmissions);
    document.getElementById('statusFilter')?.addEventListener('change', filterSubmissions);

    function filterSubmissions() {
        const search = document.getElementById('search').value.toLowerCase();
        const subject = document.getElementById('subjectFilter').value;
        const status = document.getElementById('statusFilter').value;
        
        const filtered = allSubmissions.filter(sub => {
            const matchSearch = sub.name.toLowerCase().includes(search) || sub.student_id.toLowerCase().includes(search);
            const matchSubject = !subject || sub.subject === subject;
            const matchStatus = !status || sub.status === status;
            return matchSearch && matchSubject && matchStatus;
        });
        
        renderSubmissions(filtered);
    }

    function logout() {
        fetch(`${API_BASE}/logout`, {
            method: 'POST',
            credentials: 'include'
        }).finally(() => {
            window.location.href = 'admin_login.html';
        });
    }

    switchView('submissions');
    </script>
</body>
</html>
